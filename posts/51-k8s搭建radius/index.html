<!DOCTYPE html>
<html lang="zh-hans">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<meta name="theme-color" content="#494f5c">
	<meta name="msapplication-TileColor" content="#494f5c">
<meta itemprop="name" content="k8s搭建radius">
<meta itemprop="description" content="搭建lnmp&#43;freeradius的账号认证服务
  一 记录 docker: 17.03.2-ce k8s: 1.15.11 php: 7.0.13 mysql: 5.6 freeraidus: 3.0.21 daloradius: 1.1-2 / 08 Aug 2019  配置修改简单说明:
 1. 数据库创建说明 create database radius; grant all on radius.* to radius@&#39;%&#39; identified by &#39;xxx&#39;; flush privileges; # 导入表结构 mysql -hk8s-db-t.xxx.com -P3326 -uradius -p &lt; mods-config/sql/main/mysql/schema.sql mysql -hk8s-db-t.xxx.com -P3326 -uradius -p &lt; daloradius-php/contrib/db/mysql-daloradius.sql mysql -hk8s-db-t.xxx.com -P3326 -uradius -p &lt; daloradius-php/contrib/db/fr2-mysql-daloradius-and-freeradius.sql 2. 修改freeRADIUS配置 vim /etc/raddb/radiusd.conf # 这里我是配合nginx,php统一路径 logdir = /nginx_logs 3.">
<meta itemprop="datePublished" content="2020-07-27T10:19:25+00:00" />
<meta itemprop="dateModified" content="2020-07-27T10:19:25+00:00" />
<meta itemprop="wordCount" content="1209">



<meta itemprop="keywords" content="k8s,freeradius,daloradius," />
<meta property="og:title" content="k8s搭建radius" />
<meta property="og:description" content="搭建lnmp&#43;freeradius的账号认证服务
  一 记录 docker: 17.03.2-ce k8s: 1.15.11 php: 7.0.13 mysql: 5.6 freeraidus: 3.0.21 daloradius: 1.1-2 / 08 Aug 2019  配置修改简单说明:
 1. 数据库创建说明 create database radius; grant all on radius.* to radius@&#39;%&#39; identified by &#39;xxx&#39;; flush privileges; # 导入表结构 mysql -hk8s-db-t.xxx.com -P3326 -uradius -p &lt; mods-config/sql/main/mysql/schema.sql mysql -hk8s-db-t.xxx.com -P3326 -uradius -p &lt; daloradius-php/contrib/db/mysql-daloradius.sql mysql -hk8s-db-t.xxx.com -P3326 -uradius -p &lt; daloradius-php/contrib/db/fr2-mysql-daloradius-and-freeradius.sql 2. 修改freeRADIUS配置 vim /etc/raddb/radiusd.conf # 这里我是配合nginx,php统一路径 logdir = /nginx_logs 3." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.ngirl.xyz/posts/51-k8s%E6%90%AD%E5%BB%BAradius/" />
<meta property="article:published_time" content="2020-07-27T10:19:25+00:00" />
<meta property="article:modified_time" content="2020-07-27T10:19:25+00:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="k8s搭建radius"/>
<meta name="twitter:description" content="搭建lnmp&#43;freeradius的账号认证服务
  一 记录 docker: 17.03.2-ce k8s: 1.15.11 php: 7.0.13 mysql: 5.6 freeraidus: 3.0.21 daloradius: 1.1-2 / 08 Aug 2019  配置修改简单说明:
 1. 数据库创建说明 create database radius; grant all on radius.* to radius@&#39;%&#39; identified by &#39;xxx&#39;; flush privileges; # 导入表结构 mysql -hk8s-db-t.xxx.com -P3326 -uradius -p &lt; mods-config/sql/main/mysql/schema.sql mysql -hk8s-db-t.xxx.com -P3326 -uradius -p &lt; daloradius-php/contrib/db/mysql-daloradius.sql mysql -hk8s-db-t.xxx.com -P3326 -uradius -p &lt; daloradius-php/contrib/db/fr2-mysql-daloradius-and-freeradius.sql 2. 修改freeRADIUS配置 vim /etc/raddb/radiusd.conf # 这里我是配合nginx,php统一路径 logdir = /nginx_logs 3."/>

	<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
	<link rel="manifest" href="/site.webmanifest">
	<link rel="mask-icon" href="/safari-pinned-tab.svg" color="">
	<link rel="shortcut icon" href="/favicon.ico">

	<title>k8s搭建radius</title>
	<link rel="stylesheet" href="https://www.ngirl.xyz/css/style.min.d3141168199607bf3a517216ce3c263814eecdbc8fca72a9a88700799a838219.css">
	
</head>

<body id="page">
	
	<header id="site-header" class="animated slideInUp faster">
		<div class="hdr-wrapper section-inner">
			<div class="hdr-left">
				<div class="site-branding">
					<a href="https://www.ngirl.xyz">zhangzw</a>
				</div>
				<nav class="site-nav hide-in-mobile">
					<a href="https://www.ngirl.xyz/golang/">golang</a>
					<a href="https://www.ngirl.xyz/posts/">文章</a>
				</nav>
			</div>
			<div class="hdr-right hdr-icons">
				<button id="toc-btn" class="hdr-btn desktop-only-ib" title="Table of Contents"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-list"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3" y2="6"></line><line x1="3" y1="12" x2="3" y2="12"></line><line x1="3" y1="18" x2="3" y2="18"></line></svg></button><span class="hdr-social hide-in-mobile"><a href="https://github.com/zhangzw001" target="_blank" rel="noopener me" title="Github"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></a></span><button id="menu-btn" class="hdr-btn" title="Menu"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></button>
			</div>
		</div>
	</header>
	<div id="mobile-menu" class="animated fast">
		<ul>
			<li><a href="https://www.ngirl.xyz/posts/">文章</a></li>
			<li><a href="https://www.ngirl.xyz/tags/">标签</a></li>
			<li><a href="https://www.ngirl.xyz/about/">关于</a></li>
		</ul>
	</div>



	<main class="site-main section-inner animated fadeIn faster">
		<article class="thin">
			<header class="post-header">
				<div class="post-meta"><span>Jul 27, 2020</span></div>
				<h1>k8s搭建radius</h1>
			</header>
			<div class="content">
				<p>搭建lnmp+freeradius的账号认证服务</p>
<!-- more -->
<center>
<img src="//zhangzw001.github.io/images/dockerniu.jpeg" width = "100" height = "100" style="border: 0"/>
</center>
<h3 id="一-记录">一 记录<a href="#一-记录" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<pre><code>docker:   17.03.2-ce
k8s:   1.15.11
php:   7.0.13
mysql:   5.6
freeraidus:  3.0.21
daloradius:  1.1-2 / 08 Aug 2019

</code></pre><blockquote>
<p>配置修改简单说明:</p>
</blockquote>
<pre><code>1. 数据库创建说明
create database radius;
grant all on radius.* to radius@'%' identified by 'xxx';
flush privileges;

# 导入表结构
mysql -hk8s-db-t.xxx.com -P3326 -uradius -p &lt; mods-config/sql/main/mysql/schema.sql
mysql -hk8s-db-t.xxx.com -P3326 -uradius -p &lt; daloradius-php/contrib/db/mysql-daloradius.sql
mysql -hk8s-db-t.xxx.com -P3326 -uradius -p &lt; daloradius-php/contrib/db/fr2-mysql-daloradius-and-freeradius.sql

2. 修改freeRADIUS配置
vim /etc/raddb/radiusd.conf
# 这里我是配合nginx,php统一路径
logdir = /nginx_logs 

3. 修改为sql认证
 cd /etc/raddb/mods-enabled
 ln -s ../mods-available/sql

4. 修改FreeRADIUS中的mysql 配置文件
 dialect = &quot;mysql&quot;
 //下列配置前的注释去掉
 server = &quot;k8s-db-t.xxx.com&quot; //mysql服务器地址,如果是同一个k8s集群, 写k8s内网的svc域名即可,例如: freeradius-mysql-dev 或 freeradius-mysql-dev.radius-dev.svc.cluster.local
 port = 3326 //mysql 端口号
 login = &quot;radius&quot; //myqsl 登录用户名
 password = &quot;xxx&quot; //mysql 登录密码
 read_clients = yes

5. 开放daloradius服务器验证权限
vim /etc/raddb/clients.conf
client php-fpm {
 ipaddr = php-fpm
 secret  = testing123
}

6. 修改daloradius默认php配置
vim daloradius-php/library/daloradius.conf.php
$configValues['CONFIG_MAINT_TEST_USER_RADIUSSERVER'] = 'radius';
$configValues['CONFIG_MAINT_TEST_USER_RADIUSSECRET'] = 'testing123';
</code></pre><center>
<img src="//zhangzw001.github.io/images/dockerniu.jpeg" width = "100" height = "100" style="border: 0"/>
</center>
<h3 id="二-首先搭建数据库">二 首先搭建数据库<a href="#二-首先搭建数据库" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<h4 id="k8s-freeradius-mysql-dev_5636-configmapyml">k8s-freeradius-mysql-dev_5.6.36-configmap.yml<a href="#k8s-freeradius-mysql-dev_5636-configmapyml" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nn">---</span><span class="w">
</span><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ConfigMap</span><span class="w">
</span><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">freeradius-mysql-dev</span><span class="w">
</span><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">freeradius-mysql-dev</span><span class="w">
</span><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">db</span><span class="w">
</span><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span><span class="w"></span><span class="nt">data</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">my.cnf</span><span class="p">:</span><span class="w"> </span><span class="l">|</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="p">[</span><span class="l">mysqld]</span><span class="w">
</span><span class="w">    </span><span class="l">innodb_file_per_table=1</span><span class="w">
</span><span class="w">    </span><span class="l">user=mysql</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="l">datadir=/data</span><span class="w">
</span><span class="w">    </span><span class="l">socket=/data/mysql.sock</span><span class="w">
</span><span class="w">    </span><span class="l">symbolic-links=0</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="l">binlog_format=mixed</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="c">#log-bin=mysql-bin</span><span class="w">
</span><span class="w">    </span><span class="l">log-bin=/data/mysql-bin.log</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="c">#general_log   = 1</span><span class="w">
</span><span class="w">    </span><span class="c">#general_log_file = /data/general.log</span><span class="w">
</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="c">#日志</span><span class="w">
</span><span class="w">    </span><span class="l">log-error=/data/mysqld.log</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="l">innodb_log_file_size = 256M</span><span class="w">
</span><span class="w">    </span><span class="l">thread_cache_size = 50</span><span class="w">
</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="l">max_allowed_packet=16M</span><span class="w">
</span><span class="w">    </span><span class="l">max_binlog_size=500M</span><span class="w">
</span><span class="w">    </span><span class="c">#old_passwords=1</span><span class="w">
</span><span class="w">    </span><span class="l">character-set-server=utf8</span><span class="w">
</span><span class="w">    </span><span class="l">max_connections=3000</span><span class="w">
</span><span class="w">    </span><span class="l">skip-name-resolve</span><span class="w">
</span><span class="w">    </span><span class="l">max_allowed_packet=64M</span><span class="w">
</span><span class="w">    </span><span class="l">tmp_table_size=200M</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="l">server-id=101</span><span class="w">
</span><span class="w">    </span><span class="l">port=3306</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="l">skip_slave_start</span><span class="w">
</span><span class="w">    </span><span class="l">expire_logs_days=7</span><span class="w">
</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="p">[</span><span class="l">mysqld_safe]</span><span class="w">
</span><span class="w">    </span><span class="l">log-error=/data/mysqld.log</span><span class="w">
</span><span class="w">    </span><span class="l">pid-file=/data/mysqld.pid</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="p">[</span><span class="l">mysql]</span><span class="w">
</span><span class="w">    </span><span class="kc">no</span>-<span class="l">auto-rehash</span><span class="w">
</span><span class="w">    </span><span class="l">user=root</span><span class="w">
</span><span class="w">    </span><span class="l">default-character-set=utf8</span><span class="w">
</span><span class="w">    </span><span class="l">socket=/data/mysql.sock</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="p">[</span><span class="l">client]</span><span class="w">
</span><span class="w">    </span><span class="l">socket=/data/mysql.sock</span><span class="w">
</span></code></pre></div><h4 id="k8s-freeradius-mysql-dev_5636yml">k8s-freeradius-mysql-dev_5.6.36.yml<a href="#k8s-freeradius-mysql-dev_5636yml" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nn">---</span><span class="w">
</span><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">apps/v1</span><span class="w">
</span><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Deployment</span><span class="w">
</span><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">freeradius-mysql-dev</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">freeradius-mysql-dev</span><span class="w">
</span><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">db</span><span class="w">
</span><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">freeradius-mysql-dev</span><span class="w">
</span><span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">freeradius-mysql-dev</span><span class="w">
</span><span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span><span class="w">       </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">freeradius-mysql-dev</span><span class="w">
</span><span class="w">         </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">hub.xxx.com/mysql:5.6.36-Asia</span><span class="w">
</span><span class="w">         </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span><span class="w">         </span>- <span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="m">3306</span><span class="w">
</span><span class="w">           </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">db-port</span><span class="w">
</span><span class="w">         </span><span class="nt">resources</span><span class="p">:</span><span class="w">
</span><span class="w">           </span><span class="nt">requests</span><span class="p">:</span><span class="w">
</span><span class="w">             </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;50m&#34;</span><span class="w">
</span><span class="w">           </span><span class="nt">limits</span><span class="p">:</span><span class="w">
</span><span class="w">             </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;1&#34;</span><span class="w">
</span><span class="w">         </span><span class="nt">env</span><span class="p">:</span><span class="w">
</span><span class="w">         </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">MYSQL_ROOT_PASSWORD</span><span class="w">
</span><span class="w">           </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;xxx&#34;</span><span class="w">
</span><span class="w">         </span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w">
</span><span class="w">         </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">freeradius-mysql-dev-data</span><span class="w">
</span><span class="w">           </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/data</span><span class="w">
</span><span class="w">         </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">freeradius-mysql-dev-conf</span><span class="w">
</span><span class="w">           </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/etc/mysql/my.cnf</span><span class="w">
</span><span class="w">           </span><span class="nt">subPath</span><span class="p">:</span><span class="w"> </span><span class="l">my.cnf</span><span class="w">
</span><span class="w">      </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">freeradius-mysql-dev-data</span><span class="w">
</span><span class="w">          </span><span class="nt">nfs</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="nt">server</span><span class="p">:</span><span class="w"> </span><span class="l">xxx.xxx.xxx.194</span><span class="w">
</span><span class="w">            </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/disk/k8s-nfs-data/k8s-db-t/freeradius-mysql-dev</span><span class="w">
</span><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">freeradius-mysql-dev-conf</span><span class="w">
</span><span class="w">          </span><span class="nt">configMap</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">freeradius-mysql-dev</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="nn">---</span><span class="w">
</span><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Service</span><span class="w">
</span><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">freeradius-mysql-dev</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">freeradius-mysql-dev</span><span class="w">
</span><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">db</span><span class="w">
</span><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">NodePort</span><span class="w">
</span><span class="w">  </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span><span class="w">    </span>- <span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">3306</span><span class="w">
</span><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">db-port</span><span class="w">
</span><span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="m">3306</span><span class="w">
</span><span class="w">      </span><span class="nt">nodePort</span><span class="p">:</span><span class="w"> </span><span class="m">3326</span><span class="w">
</span><span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">TCP</span><span class="w">
</span><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">freeradius-mysql-dev</span><span class="w">
</span></code></pre></div><h4 id="创建库和账号">创建库和账号<a href="#创建库和账号" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">create database radius<span class="p">;</span>
grant all on radius.* to radius@<span class="s1">&#39;%&#39;</span> identified by <span class="s1">&#39;xxxxxxxxxxxxxxxxxx&#39;</span><span class="p">;</span>
flush privileges<span class="p">;</span>

<span class="c1"># 测试登录</span>
mysql -hk8s-db-t.xxx.com -P3326 -uradius -p
<span class="c1"># 导入表结构</span>
mysql -hk8s-db-t.xxx.com -P3326 -uradius -p &lt; mods-config/sql/main/mysql/schema.sql
mysql -hk8s-db-t.xxx.com -P3326 -uradius -p &lt; daloradius-php/contrib/db/mysql-daloradius.sql
</code></pre></div><center>
<img src="//zhangzw001.github.io/images/dockerniu.jpeg" width = "100" height = "100" style="border: 0"/>
</center>
<h3 id="三-部署freeradius">三 部署freeradius<a href="#三-部署freeradius" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<h4 id="deployment-freeradiusyml">deployment-freeradius.yml<a href="#deployment-freeradiusyml" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">apps/v1</span><span class="w">
</span><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Deployment</span><span class="w">
</span><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">freeradius-dev</span><span class="w">
</span><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">freeradius-dev</span><span class="w">
</span><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">radius-dev</span><span class="w">
</span><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">freeradius-dev</span><span class="w">
</span><span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">freeradius-dev</span><span class="w">
</span><span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">freeradius-dev</span><span class="w">
</span><span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">hub.xxx.com/freeradius-server:3.0.21</span><span class="w">
</span><span class="w">        </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- <span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="m">1812</span><span class="w">
</span><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">port-1812</span><span class="w">
</span><span class="w">          </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">UDP</span><span class="w">
</span><span class="w">        </span>- <span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="m">1813</span><span class="w">
</span><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">port-1813</span><span class="w">
</span><span class="w">          </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">UDP</span><span class="w">
</span><span class="w">        </span><span class="nt">resources</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="nt">requests</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;30m&#34;</span><span class="w">
</span><span class="w">          </span><span class="nt">limits</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;1&#34;</span><span class="w">
</span><span class="w">        </span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">daloradius-freeradius-sql-dev</span><span class="w">
</span><span class="w">          </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/etc/raddb/mods-available/sql</span><span class="w">
</span><span class="w">          </span><span class="nt">subPath</span><span class="p">:</span><span class="w"> </span><span class="l">sql</span><span class="w">
</span><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">daloradius-freeradius-sql-dev</span><span class="w">
</span><span class="w">          </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/etc/raddb/mods-enabled/sql</span><span class="w">
</span><span class="w">          </span><span class="nt">subPath</span><span class="p">:</span><span class="w"> </span><span class="l">sql</span><span class="w">
</span><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">daloradius-freeradius-radiusd-dev</span><span class="w">
</span><span class="w">          </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/etc/raddb/radiusd.conf</span><span class="w">
</span><span class="w">          </span><span class="nt">subPath</span><span class="p">:</span><span class="w"> </span><span class="l">radiusd.conf</span><span class="w">
</span><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">daloradius-freeradius-clients-dev</span><span class="w">
</span><span class="w">          </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/etc/raddb/clients.conf</span><span class="w">
</span><span class="w">          </span><span class="nt">subPath</span><span class="p">:</span><span class="w"> </span><span class="l">clients.conf</span><span class="w">
</span><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">daloradius-freeradius-log</span><span class="w">
</span><span class="w">          </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/nginx_logs</span><span class="w">
</span><span class="w">      </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">daloradius-freeradius-sql-dev</span><span class="w">
</span><span class="w">          </span><span class="nt">configMap</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">daloradius-freeradius-sql-dev</span><span class="w">
</span><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">daloradius-freeradius-radiusd-dev</span><span class="w">
</span><span class="w">          </span><span class="nt">configMap</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">daloradius-freeradius-radiusd-dev</span><span class="w">
</span><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">daloradius-freeradius-clients-dev</span><span class="w">
</span><span class="w">          </span><span class="nt">configMap</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">daloradius-freeradius-clients-dev</span><span class="w">
</span><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">daloradius-freeradius-log</span><span class="w">
</span><span class="w">          </span><span class="nt">nfs</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="nt">server</span><span class="p">:</span><span class="w"> </span><span class="l">xxx.xxx.xxx.194</span><span class="w">
</span><span class="w">            </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/disk/k8s-nfs-data/k8s1-t/daloradius-php/nginx_logs</span><span class="w">
</span><span class="w"></span><span class="nn">---</span><span class="w">
</span><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Service</span><span class="w">
</span><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">freeradius-dev</span><span class="w">
</span><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">radius-dev</span><span class="w">
</span><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">freeradius-dev</span><span class="w">
</span><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">ClusterIP</span><span class="w">
</span><span class="w">  </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">port-1812</span><span class="w">
</span><span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">1812</span><span class="w">
</span><span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">UDP</span><span class="w">
</span><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">port-1813</span><span class="w">
</span><span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">1813</span><span class="w">
</span><span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">UDP</span><span class="w">
</span><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">freeradius-dev</span><span class="w">
</span><span class="w"></span><span class="nn">---</span><span class="w">
</span><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Service</span><span class="w">
</span><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">freeradius-dev-svc</span><span class="w">
</span><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">radius-dev</span><span class="w">
</span><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">freeradius-dev</span><span class="w">
</span><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">NodePort</span><span class="w">
</span><span class="w">  </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">port-1812</span><span class="w">
</span><span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">1812</span><span class="w">
</span><span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="m">1812</span><span class="w">
</span><span class="w">      </span><span class="nt">nodePort</span><span class="p">:</span><span class="w"> </span><span class="m">1812</span><span class="w">
</span><span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">UDP</span><span class="w">
</span><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">port-1813</span><span class="w">
</span><span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">1813</span><span class="w">
</span><span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="m">1813</span><span class="w">
</span><span class="w">      </span><span class="nt">nodePort</span><span class="p">:</span><span class="w"> </span><span class="m">1813</span><span class="w">
</span><span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">UDP</span><span class="w">
</span><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">freeradius-dev</span><span class="w">
</span></code></pre></div><h4 id="configmap-freeradius-radiusd-confyaml">configmap-freeradius-radiusd-conf.yaml<a href="#configmap-freeradius-radiusd-confyaml" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nn">---</span><span class="w">
</span><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ConfigMap</span><span class="w">
</span><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">daloradius-freeradius-radiusd-dev</span><span class="w">
</span><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">daloradius-freeradius-radiusd-dev</span><span class="w">
</span><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">radius-dev</span><span class="w">
</span><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span><span class="w"></span><span class="nt">data</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">radiusd.conf</span><span class="p">:</span><span class="w"> </span><span class="p">|</span><span class="sd">
</span><span class="sd">    prefix = /usr
</span><span class="sd">    exec_prefix = /usr
</span><span class="sd">    sysconfdir = /etc
</span><span class="sd">    localstatedir = /var
</span><span class="sd">    sbindir = ${exec_prefix}/sbin
</span><span class="sd">    logdir = /nginx_logs
</span><span class="sd">    raddbdir = /etc/freeradius
</span><span class="sd">    radacctdir = ${logdir}/radacct
</span><span class="sd">
</span><span class="sd">
</span><span class="sd">    name = freeradius
</span><span class="sd">    confdir = ${raddbdir}
</span><span class="sd">    modconfdir = ${confdir}/mods-config
</span><span class="sd">    certdir = ${confdir}/certs
</span><span class="sd">    cadir   = ${confdir}/certs
</span><span class="sd">    run_dir = ${localstatedir}/run/${name}
</span><span class="sd">
</span><span class="sd">    # Should likely be ${localstatedir}/lib/radiusd
</span><span class="sd">    db_dir = ${raddbdir}
</span><span class="sd">
</span><span class="sd">
</span><span class="sd">    libdir = /usr/lib/freeradius
</span><span class="sd">
</span><span class="sd">
</span><span class="sd">    pidfile = ${run_dir}/${name}.pid
</span><span class="sd">
</span><span class="sd">    correct_escapes = true
</span><span class="sd">
</span><span class="sd">
</span><span class="sd">    max_request_time = 30
</span><span class="sd">
</span><span class="sd">    cleanup_delay = 5
</span><span class="sd">
</span><span class="sd">    max_requests = 16384
</span><span class="sd">
</span><span class="sd">    hostname_lookups = no
</span><span class="sd">
</span><span class="sd">
</span><span class="sd">    log {
</span><span class="sd">
</span><span class="sd">     destination = files
</span><span class="sd">
</span><span class="sd">     colourise = yes
</span><span class="sd">
</span><span class="sd">     file = ${logdir}/radius.log
</span><span class="sd">
</span><span class="sd">     syslog_facility = daemon
</span><span class="sd">
</span><span class="sd">     stripped_names = no
</span><span class="sd">
</span><span class="sd">     auth = yes
</span><span class="sd">
</span><span class="sd">     # auth_accept = no
</span><span class="sd">     # auth_reject = no
</span><span class="sd">     auth_badpass = yes
</span><span class="sd">     auth_goodpass = yes
</span><span class="sd">     msg_denied = &#34;You are already logged in - access denied&#34;
</span><span class="sd">    }
</span><span class="sd">
</span><span class="sd">    checkrad = ${sbindir}/checkrad
</span><span class="sd">
</span><span class="sd">    ENV {
</span><span class="sd">
</span><span class="sd">    }
</span><span class="sd">
</span><span class="sd">
</span><span class="sd">    security {
</span><span class="sd">
</span><span class="sd">     user = freerad
</span><span class="sd">     group = freerad
</span><span class="sd">
</span><span class="sd">     allow_core_dumps = no
</span><span class="sd">
</span><span class="sd">     max_attributes = 200
</span><span class="sd">
</span><span class="sd">     reject_delay = 1
</span><span class="sd">
</span><span class="sd">     status_server = yes
</span><span class="sd">
</span><span class="sd">
</span><span class="sd">    }
</span><span class="sd">
</span><span class="sd">    proxy_requests  = yes
</span><span class="sd">    $INCLUDE proxy.conf
</span><span class="sd">
</span><span class="sd">    $INCLUDE clients.conf
</span><span class="sd">
</span><span class="sd">    thread pool {
</span><span class="sd">
</span><span class="sd">     start_servers = 5
</span><span class="sd">
</span><span class="sd">     max_servers = 32
</span><span class="sd">
</span><span class="sd">     min_spare_servers = 3
</span><span class="sd">     max_spare_servers = 10
</span><span class="sd">
</span><span class="sd">     max_requests_per_server = 0
</span><span class="sd">
</span><span class="sd">     auto_limit_acct = no
</span><span class="sd">    }
</span><span class="sd">
</span><span class="sd">    modules {
</span><span class="sd">
</span><span class="sd">     $INCLUDE mods-enabled/
</span><span class="sd">    }
</span><span class="sd">
</span><span class="sd">
</span><span class="sd">    instantiate {
</span><span class="sd">
</span><span class="sd">    }
</span><span class="sd">
</span><span class="sd">
</span><span class="sd">    policy {
</span><span class="sd">     $INCLUDE policy.d/
</span><span class="sd">    }
</span><span class="sd">
</span><span class="sd">    $INCLUDE sites-enabled/</span><span class="w">    
</span><span class="w">
</span><span class="w">
</span></code></pre></div><h4 id="configmap-freeradius-clients-confyaml">configmap-freeradius-clients-conf.yaml<a href="#configmap-freeradius-clients-confyaml" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nn">---</span><span class="w">
</span><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ConfigMap</span><span class="w">
</span><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">daloradius-freeradius-clients-dev</span><span class="w">
</span><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">daloradius-freeradius-clients-dev</span><span class="w">
</span><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">radius-dev</span><span class="w">
</span><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span><span class="w"></span><span class="nt">data</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">clients.conf</span><span class="p">:</span><span class="w"> </span><span class="p">|</span><span class="sd">
</span><span class="sd">    client php-fpm {
</span><span class="sd">     ipaddr = php-fpm
</span><span class="sd">     secret  = testing123
</span><span class="sd">    }
</span><span class="sd">    client localhost {
</span><span class="sd">     ipaddr = 127.0.0.1
</span><span class="sd">     proto = *
</span><span class="sd">     secret = testing123
</span><span class="sd">     require_message_authenticator = no
</span><span class="sd">     nas_type  = other # localhost isn&#39;t usually a NAS...
</span><span class="sd">     limit {
</span><span class="sd">      max_connections = 16
</span><span class="sd">      lifetime = 0
</span><span class="sd">      idle_timeout = 30
</span><span class="sd">     }
</span><span class="sd">    }
</span><span class="sd">    client localhost_ipv6 {
</span><span class="sd">     ipv6addr = ::1
</span><span class="sd">     secret  = testing123
</span><span class="sd">    }</span><span class="w">    
</span></code></pre></div><h4 id="configmap-freeradius-sqlyaml">configmap-freeradius-sql.yaml<a href="#configmap-freeradius-sqlyaml" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<blockquote>
<p>主要是修改 Connection info 的内容</p>
</blockquote>
<pre><code>---
kind: ConfigMap
metadata:
  name: daloradius-freeradius-sql-dev
  labels:
    app: daloradius-freeradius-sql-dev
  namespace: radius-dev
apiVersion: v1
data:
  sql: |
    sql {
        dialect = &quot;mysql&quot;
        driver = &quot;rlm_sql_mysql&quot;
        sqlite {
            filename = &quot;/tmp/freeradius.db&quot;
            busy_timeout = 200
            bootstrap = &quot;${modconfdir}/${..:name}/main/sqlite/schema.sql&quot;
    }

    mysql {
        }
        warnings = auto
    }

    postgresql {
        send_application_name = yes
    }

    mongo {
        appname = &quot;freeradius&quot;
        tls {
             certificate_file = /path/to/file
             certificate_password = &quot;password&quot;
             ca_file = /path/to/file
             ca_dir = /path/to/directory
             crl_file = /path/to/file
             weak_cert_validation = false
             allow_invalid_hostname = false
            }
    }

    server = &quot;k8s-db-t.xxx.com&quot;
    port = 3326
    login = &quot;radius&quot;
    password = &quot;xxxxxxxxxxxxxxxxxx&quot;
    read_clients = yes
    radius_db = &quot;radius&quot;
    acct_table1 = &quot;radacct&quot;
    acct_table2 = &quot;radacct&quot;
    postauth_table = &quot;radpostauth&quot;
    authcheck_table = &quot;radcheck&quot;
    groupcheck_table = &quot;radgroupcheck&quot;
    authreply_table = &quot;radreply&quot;
    groupreply_table = &quot;radgroupreply&quot;
    usergroup_table = &quot;radusergroup&quot;
    delete_stale_sessions = yes

    pool {
        start = ${thread[pool].start_servers}
        min = ${thread[pool].min_spare_servers}
        max = ${thread[pool].max_servers}
        spare = ${thread[pool].max_spare_servers}
        uses = 0
        retry_delay = 30
        lifetime = 0
        idle_timeout = 60
    }
    client_table = &quot;nas&quot;
    group_attribute = &quot;SQL-Group&quot;
    $INCLUDE ${modconfdir}/${.:name}/main/${dialect}/queries.conf
    }
</code></pre><center>
<img src="//zhangzw001.github.io/images/dockerniu.jpeg" width = "100" height = "100" style="border: 0"/>
</center>
<h3 id="四-部署nignxphp7的daloradius-web管理后台">四 部署nignx+php7的daloradius web管理后台<a href="#四-部署nignxphp7的daloradius-web管理后台" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<h4 id="php7部署配置">php7部署配置<a href="#php7部署配置" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<h5 id="php镜像安装扩展-dockerfile">php镜像安装扩展 Dockerfile<a href="#php镜像安装扩展-dockerfile" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h5>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="l">from hub.xxx.com/php:develop</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="l">user root</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="l">RUN pear install DB \</span><span class="w">
</span><span class="w">  </span><span class="cp">&amp;&amp;</span><span class="w"> </span><span class="l">pear install -a Mail \</span><span class="w">
</span><span class="w">  </span><span class="cp">&amp;&amp;</span><span class="w"> </span><span class="l">pear install -a Mail_Mime</span><span class="w">
</span></code></pre></div><h5 id="deployment-phpyml">deployment-php.yml<a href="#deployment-phpyml" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h5>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nn">---</span><span class="w">
</span><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">apps/v1</span><span class="w">
</span><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Deployment</span><span class="w">
</span><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">daloradius-php-dev</span><span class="w">
</span><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">daloradius-php-dev</span><span class="w">
</span><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">radius-dev</span><span class="w">
</span><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span><span class="w">  </span><span class="nt">strategy</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">rollingUpdate</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">maxSurge</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span><span class="w">      </span><span class="nt">maxUnavailable</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">RollingUpdate</span><span class="w">
</span><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">daloradius-php-dev</span><span class="w">
</span><span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">daloradius-php-dev</span><span class="w">
</span><span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">daloradius-php-dev</span><span class="w">
</span><span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">hub.xxx.com/php:radius</span><span class="w">
</span><span class="w">        </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">Always</span><span class="w">
</span><span class="w">        </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- <span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="m">9000</span><span class="w">
</span><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">fpm-9000</span><span class="w">
</span><span class="w">          </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">TCP</span><span class="w">
</span><span class="w">        </span><span class="nt">resources</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="nt">requests</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;50m&#34;</span><span class="w">
</span><span class="w">          </span><span class="nt">limits</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;600m&#34;</span><span class="w">
</span><span class="w">        </span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">daloradius-nginx-dev</span><span class="w">
</span><span class="w">          </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/webwww</span><span class="w">
</span><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">daloradius-php-cfg-dev</span><span class="w">
</span><span class="w">          </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;/usr/local/etc/php/php.ini&#34;</span><span class="w">
</span><span class="w">          </span><span class="nt">subPath</span><span class="p">:</span><span class="w"> </span><span class="l">php.ini</span><span class="w">
</span><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">daloradius-fpm-cfg-dev</span><span class="w">
</span><span class="w">          </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;/usr/local/etc/php-fpm.d/www.conf&#34;</span><span class="w">
</span><span class="w">          </span><span class="nt">subPath</span><span class="p">:</span><span class="w"> </span><span class="l">www.conf</span><span class="w">
</span><span class="w">      </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">daloradius-nginx-dev</span><span class="w">
</span><span class="w">          </span><span class="nt">nfs</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="nt">server</span><span class="p">:</span><span class="w"> </span><span class="l">xxx.xxx.xxx.194</span><span class="w">
</span><span class="w">            </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/disk/k8s-nfs-data/k8s1-t/daloradius-php</span><span class="w">
</span><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">daloradius-php-cfg-dev</span><span class="w">
</span><span class="w">          </span><span class="nt">configMap</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">daloradius-php-cfg-dev</span><span class="w">
</span><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">daloradius-fpm-cfg-dev</span><span class="w">
</span><span class="w">          </span><span class="nt">configMap</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">daloradius-fpm-cfg-dev</span><span class="w">
</span><span class="w"></span><span class="nn">---</span><span class="w">
</span><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Service</span><span class="w">
</span><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">daloradius-php-dev</span><span class="w">
</span><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">radius-dev</span><span class="w">
</span><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">daloradius-php-dev</span><span class="w">
</span><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">ClusterIP</span><span class="w">
</span><span class="w">  </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">fpm-9000</span><span class="w">
</span><span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">9000</span><span class="w">
</span><span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">TCP</span><span class="w">
</span><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">daloradius-php-dev</span><span class="w">
</span><span class="w"></span><span class="nn">---</span><span class="w">
</span><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Service</span><span class="w">
</span><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">daloradius-php-dev-svc</span><span class="w">
</span><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">radius-dev</span><span class="w">
</span><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">daloradius-php-dev</span><span class="w">
</span><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">NodePort</span><span class="w">
</span><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">daloradius-php-dev</span><span class="w">
</span><span class="w">  </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span><span class="w">   </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">fpm-9000</span><span class="w">
</span><span class="w">     </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">9000</span><span class="w">
</span><span class="w">     </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="m">9000</span><span class="w">
</span><span class="w">     </span><span class="nt">nodePort</span><span class="p">:</span><span class="w"> </span><span class="m">32101</span><span class="w">
</span><span class="w">     </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">TCP</span><span class="w">
</span></code></pre></div><h5 id="configmap-php-fpmyaml">configmap-php-fpm.yaml<a href="#configmap-php-fpmyaml" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h5>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nn">---</span><span class="w">
</span><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ConfigMap</span><span class="w">
</span><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">daloradius-fpm-cfg-dev</span><span class="w">
</span><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">daloradius-fpm-cfg-dev</span><span class="w">
</span><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">radius-dev</span><span class="w">
</span><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span><span class="w"></span><span class="nt">data</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">www.conf</span><span class="p">:</span><span class="w"> </span><span class="p">|</span><span class="sd">
</span><span class="sd">        [www]
</span><span class="sd">        user = 101
</span><span class="sd">        group = 101
</span><span class="sd">        listen = 127.0.0.1:9000
</span><span class="sd">        pm = static
</span><span class="sd">        pm.max_children = 20
</span><span class="sd">        pm.start_servers = 10
</span><span class="sd">        pm.min_spare_servers = 5
</span><span class="sd">        pm.max_spare_servers = 5</span><span class="w">        
</span></code></pre></div><h5 id="configmap-phpyaml">configmap-php.yaml<a href="#configmap-phpyaml" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h5>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nn">---</span><span class="w">
</span><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ConfigMap</span><span class="w">
</span><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">daloradius-php-cfg-dev</span><span class="w">
</span><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">daloradius-php-cfg-dev</span><span class="w">
</span><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">radius-dev</span><span class="w">
</span><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span><span class="w"></span><span class="nt">data</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">php.ini</span><span class="p">:</span><span class="w"> </span><span class="p">|</span><span class="sd">
</span><span class="sd">        [PHP]
</span><span class="sd">        engine = On
</span><span class="sd">        short_open_tag = Off
</span><span class="sd">        precision = 14
</span><span class="sd">        output_buffering = 4096
</span><span class="sd">        zlib.output_compression = Off
</span><span class="sd">        implicit_flush = Off
</span><span class="sd">        unserialize_callback_func =
</span><span class="sd">        serialize_precision = 17
</span><span class="sd">        disable_functions =
</span><span class="sd">        disable_classes =
</span><span class="sd">        zend.enable_gc = On
</span><span class="sd">        expose_php = On
</span><span class="sd">        max_execution_time = 30
</span><span class="sd">        max_input_time = 60
</span><span class="sd">        memory_limit = 128M
</span><span class="sd">        max_input_vars = 10000
</span><span class="sd">        error_reporting = E_ALL &amp; ~E_DEPRECATED &amp; ~E_STRICT
</span><span class="sd">        display_errors = On
</span><span class="sd">        display_startup_errors = Off
</span><span class="sd">        log_errors = On
</span><span class="sd">        log_errors_max_len = 1024
</span><span class="sd">        ignore_repeated_errors = Off
</span><span class="sd">        ignore_repeated_source = Off
</span><span class="sd">        report_memleaks = On
</span><span class="sd">        track_errors = Off
</span><span class="sd">        html_errors = On
</span><span class="sd">        error_log = php_errors.log
</span><span class="sd">        variables_order = &#34;GPCS&#34;
</span><span class="sd">        request_order = &#34;GP&#34;
</span><span class="sd">        register_argc_argv = Off
</span><span class="sd">        auto_globals_jit = On
</span><span class="sd">        post_max_size = 8M
</span><span class="sd">        auto_prepend_file =
</span><span class="sd">        auto_append_file =
</span><span class="sd">        default_mimetype = &#34;text/html&#34;
</span><span class="sd">        default_charset = &#34;UTF-8&#34;
</span><span class="sd">        doc_root =
</span><span class="sd">        user_dir =
</span><span class="sd">        enable_dl = Off
</span><span class="sd">        file_uploads = On
</span><span class="sd">        upload_max_filesize = 2M
</span><span class="sd">        max_file_uploads = 20
</span><span class="sd">        allow_url_fopen = On
</span><span class="sd">        allow_url_include = Off
</span><span class="sd">        default_socket_timeout = 60
</span><span class="sd">        [CLI Server]
</span><span class="sd">        cli_server.color = On
</span><span class="sd">        [Date]
</span><span class="sd">        date.timezone =Asia/Shanghai
</span><span class="sd">        [filter]
</span><span class="sd">        [iconv]
</span><span class="sd">        [intl]
</span><span class="sd">        [sqlite3]
</span><span class="sd">        [Pcre]
</span><span class="sd">        [Pdo]
</span><span class="sd">        [Pdo_mysql]
</span><span class="sd">        pdo_mysql.cache_size = 2000
</span><span class="sd">        pdo_mysql.default_socket=
</span><span class="sd">        [Phar]
</span><span class="sd">        [mail function]
</span><span class="sd">        SMTP = localhost
</span><span class="sd">        smtp_port = 25
</span><span class="sd">        mail.add_x_header = On
</span><span class="sd">        [SQL]
</span><span class="sd">        sql.safe_mode = Off
</span><span class="sd">        [ODBC]
</span><span class="sd">        odbc.allow_persistent = On
</span><span class="sd">        odbc.check_persistent = On
</span><span class="sd">        odbc.max_persistent = -1
</span><span class="sd">        odbc.max_links = -1
</span><span class="sd">        odbc.defaultlrl = 4096
</span><span class="sd">        odbc.defaultbinmode = 1
</span><span class="sd">        [Interbase]
</span><span class="sd">        ibase.allow_persistent = 1
</span><span class="sd">        ibase.max_persistent = -1
</span><span class="sd">        ibase.max_links = -1
</span><span class="sd">        ibase.timestampformat = &#34;%Y-%m-%d %H:%M:%S&#34;
</span><span class="sd">        ibase.dateformat = &#34;%Y-%m-%d&#34;
</span><span class="sd">        ibase.timeformat = &#34;%H:%M:%S&#34;
</span><span class="sd">        [MySQLi]
</span><span class="sd">        mysqli.max_persistent = -1
</span><span class="sd">        mysqli.allow_persistent = On
</span><span class="sd">        mysqli.max_links = -1
</span><span class="sd">        mysqli.cache_size = 2000
</span><span class="sd">        mysqli.default_port = 3306
</span><span class="sd">        mysqli.default_socket =
</span><span class="sd">        mysqli.default_host =
</span><span class="sd">        mysqli.default_user =
</span><span class="sd">        mysqli.default_pw =
</span><span class="sd">        mysqli.reconnect = Off
</span><span class="sd">        [mysqlnd]
</span><span class="sd">        mysqlnd.collect_statistics = On
</span><span class="sd">        mysqlnd.collect_memory_statistics = Off
</span><span class="sd">        [OCI8]
</span><span class="sd">        [PostgreSQL]
</span><span class="sd">        pgsql.allow_persistent = On
</span><span class="sd">        pgsql.auto_reset_persistent = Off
</span><span class="sd">        pgsql.max_persistent = -1
</span><span class="sd">        pgsql.max_links = -1
</span><span class="sd">        pgsql.ignore_notice = 0
</span><span class="sd">        pgsql.log_notice = 0
</span><span class="sd">        [bcmath]
</span><span class="sd">        bcmath.scale = 0
</span><span class="sd">        [browscap]
</span><span class="sd">        [Session]
</span><span class="sd">        session.save_handler = redis
</span><span class="sd">        session.save_path = &#34;tcp://xxx.xxx.xxx.194:6399&#34;
</span><span class="sd">        session.use_strict_mode = 0
</span><span class="sd">        session.use_cookies = 1
</span><span class="sd">        session.use_only_cookies = 1
</span><span class="sd">        session.name = PHPSESSID
</span><span class="sd">        session.auto_start = 0
</span><span class="sd">        session.cookie_lifetime = 0
</span><span class="sd">        session.cookie_path = /
</span><span class="sd">        session.cookie_domain =
</span><span class="sd">        session.cookie_httponly =
</span><span class="sd">        session.serialize_handler = php
</span><span class="sd">        session.gc_probability = 1
</span><span class="sd">        session.gc_divisor = 1000
</span><span class="sd">        session.gc_maxlifetime = 1440
</span><span class="sd">        session.referer_check =
</span><span class="sd">        session.cache_limiter = nocache
</span><span class="sd">        session.cache_expire = 180
</span><span class="sd">        session.use_trans_sid = 0
</span><span class="sd">        session.hash_function = 0
</span><span class="sd">        session.hash_bits_per_character = 5
</span><span class="sd">        url_rewriter.tags = &#34;a=href,area=href,frame=src,input=src,form=fakeentry&#34;
</span><span class="sd">        [Assertion]
</span><span class="sd">        zend.assertions = -1
</span><span class="sd">        tidy.clean_output = Off
</span><span class="sd">        [soap]
</span><span class="sd">        soap.wsdl_cache_enabled=1
</span><span class="sd">        soap.wsdl_cache_dir=&#34;/tmp&#34;
</span><span class="sd">        soap.wsdl_cache_ttl=86400
</span><span class="sd">        soap.wsdl_cache_limit = 5
</span><span class="sd">        [sysvshm]
</span><span class="sd">        [ldap]
</span><span class="sd">        ldap.max_links = -1</span><span class="w">        
</span></code></pre></div><h4 id="nginx部署配置">nginx部署配置<a href="#nginx部署配置" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<h5 id="deployment-nginxyml">deployment-nginx.yml<a href="#deployment-nginxyml" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h5>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nn">---</span><span class="w">
</span><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">apps/v1</span><span class="w">
</span><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Deployment</span><span class="w">
</span><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">daloradius-nginx-dev</span><span class="w">
</span><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">daloradius-nginx-dev</span><span class="w">
</span><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">radius-dev</span><span class="w">
</span><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">daloradius-nginx-dev</span><span class="w">
</span><span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">daloradius-nginx-dev</span><span class="w">
</span><span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">daloradius-nginx-dev</span><span class="w">
</span><span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">hub.xxx.com/nginx:1.16.0-develop</span><span class="w">
</span><span class="w">        </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- <span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx-80</span><span class="w">
</span><span class="w">          </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">TCP</span><span class="w">
</span><span class="w">        </span><span class="nt">resources</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="nt">requests</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;30m&#34;</span><span class="w">
</span><span class="w">          </span><span class="nt">limits</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;500m&#34;</span><span class="w">
</span><span class="w">        </span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx-www-dev</span><span class="w">
</span><span class="w">          </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/webwww</span><span class="w">
</span><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">daloradius-nginx-dev-cm</span><span class="w">
</span><span class="w">          </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/etc/nginx/nginx.conf</span><span class="w">
</span><span class="w">          </span><span class="nt">subPath</span><span class="p">:</span><span class="w"> </span><span class="l">nginx.conf</span><span class="w">
</span><span class="w">      </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx-www-dev</span><span class="w">
</span><span class="w">          </span><span class="nt">nfs</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="nt">server</span><span class="p">:</span><span class="w"> </span><span class="l">xxx.xxx.xxx.194</span><span class="w">
</span><span class="w">            </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/disk/k8s-nfs-data/k8s1-t/daloradius-php</span><span class="w">
</span><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">daloradius-nginx-dev-cm</span><span class="w">
</span><span class="w">          </span><span class="nt">configMap</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">daloradius-nginx-dev-cm</span><span class="w">
</span><span class="w"></span><span class="nn">---</span><span class="w">
</span><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Service</span><span class="w">
</span><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w"> </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span><span class="w">   </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">daloradius-nginx-dev</span><span class="w">
</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">daloradius-nginx-dev</span><span class="w">
</span><span class="w"> </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">radius-dev</span><span class="w">
</span><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">NodePort</span><span class="w">
</span><span class="w"> </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span><span class="w">   </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx-80</span><span class="w">
</span><span class="w">     </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span><span class="w">     </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span><span class="w">     </span><span class="nt">nodePort</span><span class="p">:</span><span class="w"> </span><span class="m">32100</span><span class="w">
</span><span class="w">     </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">TCP</span><span class="w">
</span><span class="w"> </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span><span class="w">   </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">daloradius-nginx-dev</span><span class="w">
</span><span class="w"></span><span class="nn">---</span><span class="w">
</span></code></pre></div><h5 id="configmap-php-nginxyaml">configmap-php-nginx.yaml<a href="#configmap-php-nginxyaml" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h5>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nn">---</span><span class="w">
</span><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ConfigMap</span><span class="w">
</span><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">daloradius-nginx-dev-cm</span><span class="w">
</span><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">daloradius-nginx-dev</span><span class="w">
</span><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">radius-dev</span><span class="w">
</span><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span><span class="w"></span><span class="nt">data</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">nginx.conf</span><span class="p">:</span><span class="w"> </span><span class="p">|</span><span class="sd">
</span><span class="sd">    user  www-data;
</span><span class="sd">    worker_processes  1;
</span><span class="sd">
</span><span class="sd">    error_log  /var/log/nginx/error.log warn;
</span><span class="sd">    pid        /var/run/nginx.pid;
</span><span class="sd">
</span><span class="sd">
</span><span class="sd">    events {
</span><span class="sd">        worker_connections  1024;
</span><span class="sd">    }
</span><span class="sd">
</span><span class="sd">
</span><span class="sd">    http {
</span><span class="sd">        include       /etc/nginx/mime.types;
</span><span class="sd">        default_type  application/octet-stream;
</span><span class="sd">
</span><span class="sd">        log_format  main  &#39;$remote_addr - $remote_user [$time_local] &#34;$request&#34; &#39;
</span><span class="sd">                          &#39;$status $body_bytes_sent &#34;$http_referer&#34; &#39;
</span><span class="sd">                          &#39;&#34;$http_user_agent&#34; &#34;$http_x_forwarded_for&#34;&#39;;
</span><span class="sd">
</span><span class="sd">        access_log  /var/log/nginx/access.log  main;
</span><span class="sd">
</span><span class="sd">        sendfile        on;
</span><span class="sd">        #tcp_nopush     on;
</span><span class="sd">
</span><span class="sd">        keepalive_timeout  65;
</span><span class="sd">
</span><span class="sd">        #gzip  on;
</span><span class="sd">
</span><span class="sd">        include /etc/nginx/conf.d/*.conf;
</span><span class="sd">        server {
</span><span class="sd">                listen 80 default_server;
</span><span class="sd">                server_name  radius.xxx.com ;
</span><span class="sd">                root   /webwww;
</span><span class="sd">
</span><span class="sd">                location = /50x.html {
</span><span class="sd">                    root   html;
</span><span class="sd">                }
</span><span class="sd">
</span><span class="sd">               location / {
</span><span class="sd">                    index index.php  index.html index.htm;
</span><span class="sd">                }
</span><span class="sd">
</span><span class="sd">                location ~ \.php$ {
</span><span class="sd">                    fastcgi_pass   daloradius-php-dev:9000;
</span><span class="sd">                    fastcgi_index  index.php;
</span><span class="sd">                    fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;
</span><span class="sd">                    fastcgi_param  HTTP_HOST          $server_name;
</span><span class="sd">                    include        fastcgi_params;
</span><span class="sd">                }
</span><span class="sd">        }
</span><span class="sd">    }</span><span class="w">    
</span></code></pre></div><center>
<img src="//zhangzw001.github.io/images/dockerniu.jpeg" width = "100" height = "100" style="border: 0"/>
</center>
<h3 id="五-测试">五 测试<a href="#五-测试" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<h4 id="通过前端nginx代理转发到nodeport端口">通过前端nginx代理转发到nodeport端口<a href="#通过前端nginx代理转发到nodeport端口" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<pre><code> server {
        listen  80;
        charset utf-8;
        listen 443 ssl http2;
        server_name radius.xxx.com;

        ssl_certificate   /etc/nginx/server.pem;
        ssl_certificate_key   /etc/nginx/server.key;
        ssl_session_timeout 5m;
        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
        ssl_ciphers AESGCM:ALL:!DH:!EXPORT:!RC4:+HIGH:!MEDIUM:!LOW:!aNULL:!eNULL;
        ssl_prefer_server_ciphers on;

        #转向预发布环境
        location / {
            proxy_pass http://xxx.xxx.xxx.221:32100/;
            proxy_redirect http://$host:32100  http://$host;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;
        }
    }
</code></pre><h4 id="配置k8s的ingress">配置k8s的ingress<a href="#配置k8s的ingress" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nn">---</span><span class="w">
</span><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">extensions/v1beta1</span><span class="w">
</span><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Ingress</span><span class="w">
</span><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">daloradius-nginx-dev</span><span class="w">
</span><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">daloradius-nginx-dev</span><span class="w">
</span><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">radius-dev</span><span class="w">
</span><span class="w">  </span><span class="nt">annotations</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">kubernetes.io/ingress.class</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;traefik&#34;</span><span class="w">
</span><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">rules</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- <span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l">radius.xxx.com</span><span class="w">
</span><span class="w">    </span><span class="nt">http</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">paths</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/</span><span class="w">
</span><span class="w">        </span><span class="nt">backend</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="nt">serviceName</span><span class="p">:</span><span class="w"> </span><span class="l">daloradius-nginx-dev</span><span class="w">
</span><span class="w">          </span><span class="nt">servicePort</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></code></pre></div><h4 id="登录测试">登录测试<a href="#登录测试" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<pre><code>登录地址: radius.xxx.com
账号密码: administrator/radius
</code></pre><h4 id="通过后台新建账号之后-测试账号连通性">通过后台新建账号之后, 测试账号连通性<a href="#通过后台新建账号之后-测试账号连通性" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<h5 id="命令行">命令行<a href="#命令行" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h5>
<pre><code># 在freeradius 容器内支线
radtest xxx xxx 127.0.0.1 0 testing123


</code></pre><h4 id="通过radiusxxxcom-管理页面测试连通性">通过radius.xxx.com 管理页面测试连通性<a href="#通过radiusxxxcom-管理页面测试连通性" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<blockquote>
<p>这是认证通过的
<img src="//zhangzw001.github.io/images/51/img2.jpg" alt=""></p>
</blockquote>
<blockquote>
<p>这是被rejected
<img src="//zhangzw001.github.io/images/51/img.jpg" alt=""></p>
</blockquote>

			</div>
   

			<hr class="post-end">
			<footer class="post-info">
				<p>
					<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg><span class="tag"><a href="https://www.ngirl.xyz/tags/k8s">k8s</a></span><span class="tag"><a href="https://www.ngirl.xyz/tags/freeradius">freeradius</a></span><span class="tag"><a href="https://www.ngirl.xyz/tags/daloradius">daloradius</a></span>
				</p>
				<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>1209 Words</p>
				<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>2020-07-27 18:19 &#43;0800</p>
			</footer>
		</article>
		<aside id="toc" class="show-toc">
			<div class="toc-title">Table of Contents</div>
			<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#一-记录">一 记录</a></li>
        <li><a href="#二-首先搭建数据库">二 首先搭建数据库</a></li>
        <li><a href="#三-部署freeradius">三 部署freeradius</a></li>
        <li><a href="#四-部署nignxphp7的daloradius-web管理后台">四 部署nignx+php7的daloradius web管理后台</a></li>
        <li><a href="#五-测试">五 测试</a></li>
      </ul>
    </li>
  </ul>
</nav>
		</aside>
		<div class="post-nav thin">
			<a class="next-post" href="https://www.ngirl.xyz/posts/52-istio%E6%B5%8B%E8%AF%95nginx-php%E9%A1%B9%E7%9B%AE/">
				<span class="post-nav-label"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>&nbsp;Newer</span><br><span>istio环境下配置nginx&#43;php</span>
			</a>
			<a class="prev-post" href="https://www.ngirl.xyz/posts/50-%E8%AE%B0%E4%B8%80%E6%AC%A1windows%E5%AE%89%E8%A3%85openssh%E9%97%AE%E9%A2%98/">
				<span class="post-nav-label">Older&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><br><span>记一次windows安装OpenSSH问题</span>
			</a>
		</div>
		<div id="comments" class="thin">
						<script src="https://utteranc.es/client.js"
							repo="zhangzw001/blog-hugo"
							issue-term="pathname"
							theme="github-light"
							crossorigin="anonymous"
							async>
			</script>

		</div>
	</main>

	<footer id="site-footer" class="section-inner thin animated fadeIn faster">
		<p>&copy; 2019 - 2021 <a href="https://www.ngirl.xyz">zhangzw</a> &#183; <a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC BY-NC 4.0</a></p>
		<p>
			Made with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> &#183; Theme <a href="https://github.com/Track3/hermit" target="_blank" rel="noopener">Hermit</a> &#183; <a href="https://www.ngirl.xyz/post/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a>
		</p>
	</footer>


	<script src="https://www.ngirl.xyz/js/main.min.784417f5847151f848c339cf0acb13a06cbb648b1483435a28ed4556c4ead69b.js"></script>
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-180942795-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


</body>

</html>
